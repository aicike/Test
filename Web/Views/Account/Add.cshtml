@{
  
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
    ViewBag.Menu = Poco.SystemConst.Menu.Account;
}
@section head{
    <script type="text/javascript">

        var isTrue = true;
        var isCommit = true;//验证只能连续点击一次添加按钮

        $(function () {
            var CheckIsExistAdminUrl = '@Url.Action("CheckIsExistAdmin", "Account")';

//            $("#btnUpload").click(function () {
//                $("#HeadImagePathFile").click();
//            });

            $("#HeadImagePathFile").change(function () {
                var fileName = $("#HeadImagePathFile").val();
                $("#Account_HeadImagePath").val(fileName);
                var suffix = fileName.substring(fileName.lastIndexOf('.')).toLowerCase();
                $("span[data-valmsg-for='Account_HeadImagePath']").empty().attr("class", "field-validation-valid");
                var isOk = false;
                switch (suffix) {
                    case ".jpg":
                    case ".jpeg":
                    case ".png":
                    case ".gif":
                    case ".bmp":
                        isOk = true;
                        break;
                    default:
                        $("#HeadImagePathFile").val("");
                        $("span[data-valmsg-for='Account_HeadImagePath']").text("支持下列图片格式：.jpg|.jpeg|.png|.gif|.bmp").attr("class", "field-validation-error");
                        break;
                }
                if (isOk) {
                    var input = this;
                    if (input.files && input.files[0]) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            $("#imgLogo").attr('src', e.target.result);
                        };
                        reader.readAsDataURL(input.files[0]);
                    }
                }
                return false;
            });
            $("#Account_RoleID").change(function () {
                var index = $(this).val();
                var value = $(this).find("option[value='" + index + "']").text();
                if (value == "管理员") {
                    $.get(CheckIsExistAdminUrl, {}, function (result) {
                        if (result.length > 0) {
                            eval(result);
                        } else {

                        }
                    });
                }
            });



            //唯一验证
            $("#Account_Email").blur(function () {

                var values = $("#Account_Email").val();

                if (values != "" && values != undefined) {
                    var YZUrl = '@Url.Action("OnlyValidation", "Ajax", new { Area = "", HostName = "" })';
                    $.post(YZUrl, { tableName: "Account", field: "Email", value: values }, function (result) {

                        if (result == "True") {
                            isTrue = true;
                        }
                        else {
                            isTrue = false;
                            JAlert({
                                Message: "该邮箱已存在！请换个邮箱试试！",
                                DialogType: "Ok",
                                BtnOk: "确定"
                            });
                        }
                    });
                }

            });

            $("#btnSubmit").click(function () {
                if (!isTrue) {
                    JAlert({
                        Message: "该邮箱已存在！请换个邮箱试试！",
                        DialogType: "Ok",
                        BtnOk: "确定"
                    });
                    return false;
                }
//                if (!isCommit) {
//                    return false;
//                }
//                isCommit = false;


            });
        });
    </script>
}
@model Poco.Account_AccountMain
<div class="title">
    添加账号</div>
<div class="body">
    @using (Html.BeginForm("Add", "Account", new { HostName = @ViewBag.HostName }, FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <fieldset>
            <legend>账号信息</legend>
            <table>
             <tr>
                    <td rowspan="2">
                        <span>&nbsp;&nbsp;</span> 头像
                    </td>
                    <td>
                        <img id="imgLogo" src="@Url.Content("/Images/default_Avatar.png")" style="max-width: 100px; max-height: 100px; float: left" />
                       
                        @Html.TextBoxFor(a => a.Account.HeadImagePath, new { style = "width:0px;visibility:hidden" })
                    </td>
                    <td>@Html.ValidationMessageFor(a => a.Account.HeadImagePath)
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="file" id="HeadImagePathFile" name="HeadImagePathFile" style="" />
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td class="tdTitle">
                        <span class="Identification">*</span> 名称
                    </td>
                    <td class="tdField">@Html.TextBoxFor(a => a.Account.Name)
                        <input type="hidden" id="AccountMainID" name="AccountMainID" value="@ViewBag.AccountMainID" />
                    </td>
                    <td>@Html.ValidationMessageFor(a => a.Account.Name)
                    </td>
                </tr>
                <tr>
                    <td>
                        <span class="Identification">*</span> 邮箱
                    </td>
                    <td>@Html.TextBoxFor(a => a.Account.Email)
                    </td>
                    <td>@Html.ValidationMessageFor(a => a.Account.Email)
                    </td>
                </tr>
                <tr>
                    <td>
                        <span class="Identification">*</span> 密码
                    </td>
                    <td>@Html.PasswordFor(a => a.Account.LoginPwdPage)
                    </td>
                    <td>@Html.ValidationMessageFor(a => a.Account.LoginPwdPage)
                    </td>
                </tr>
                <tr>
                    <td>
                        <span class="Identification">*</span> 确认密码
                    </td>
                    <td>@Html.PasswordFor(a => a.Account.LoginPwdPageCompare)
                    </td>
                    <td>@Html.ValidationMessageFor(a => a.Account.LoginPwdPageCompare)
                    </td>
                </tr>
                <tr>
                    <td>
                        <span class="Identification">*</span> 电话
                    </td>
                    <td>@Html.TextBoxFor(a => a.Account.Phone)
                    </td>
                    <td>@Html.ValidationMessageFor(a => a.Account.Phone)
                    </td>
                </tr>
               
                <tr>
                    <td>
                        <span class="Identification">*</span> 角色
                    </td>
                    <td>@Html.DropDownListFor(a => a.Account.RoleID, ViewData["Roles"] as List<SelectListItem>, new { })
                    </td>
                    <td id="tdRoleValidation">
                        @Html.ValidationMessageFor(a => a.Account.RoleID)
                    </td>
                </tr>
            </table>
        </fieldset>
        <div class="action">
            <input type="submit" id="btnSubmit" value="保存" class="button"  style="margin-right: 20px" /><input type="button" value="返回" onclick="location.href='@ViewBag.RawUrl'" class="button" />
        </div>
    }</div>
