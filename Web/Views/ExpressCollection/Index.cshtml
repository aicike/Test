@{
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
    ViewBag.Menu2 = Poco.SystemConst.Menu.ExpressCollection;
}
@section head{
    <script>


        $(function () {
            $("label[name=labCbFirst]").each(function () {
                $(this).tipTip({ activation: "hover", delay: 3, defaultPosition: "bottom" });
            });
        });

        
        function SetStatus(id, thisstatus,a) {
            var url = '@Url.Action("SetStatus", "ExpressCollection")';
            $.post(url, { ID: id, ThisStatus: thisstatus }, function (result) {
                if (result == "false") {

                    JMessage("设置失败");
                }
                else {
                    JMessage("设置成功");
                    var strs = result.split(",");
                    $(a).text(strs[2]);
                    $(a).removeAttr("onclick");
                    $(a).unbind("click"); 
                    $(a).click(function () {
                        SetStatus(id, strs[1], a) 
                    });
                }
            });

        }

    </script>
}
@model PagedList<Poco.ExpressCollection>
<div class="title">
    @Html.Partial("Menu3")
</div>
<div class="body">
    <div class="option">
        @Html.ActionLink("添加快递", "Add", "ExpressCollection", new { HostName = ViewBag.HostName }, null, true)
    </div>
    @using (Html.BeginForm("Index", "ExpressCollection", new { HostName = ViewBag.HostName }, FormMethod.Get, new { enctype = "multipart/form-data" }))
    {
        <table>
            <tr>
                <td>
                    单号：
                </td>
                <td>
                    <input type="text" id="OddNumber" name="OddNumber" />
                </td>
                <td>
                    电话：
                </td>
                <td>
                    <input type="text" id="phone" name="phone" />
                </td>
                <td>
                    <input type="submit" id="btnSubmit" value="查询" class="button" style="" />
                </td>
            </tr>
        </table>
    }
    <div class="pages" style="margin-bottom: 5px; margin-top: 10px; margin-bottom: 10px;">
        @Html.Pager(Model, new PagerOptions
   {
       PageIndexParameterName = "ID",
       CurrentPagerItemWrapperFormatString = "<span class=\"pagenum_selected\"><a>{0}</a></span>",
       NumericPagerItemWrapperFormatString = "<span class=\"pagenum\">{0}</span>",
       NavigationPagerItemWrapperFormatString = "<span class=\"pagenum\">{0}</span>",
       CssClass = "manage_pages pages",
       SeparatorHtml = "&nbsp;",
       AutoHide = false,
       /*LastPageText = "Last",
       FirstPageText = "First",
       PrevPageText = "Back",
       NextPageText = "Next",*/
       PageIndexOutOfRangeErrorMessage = "Page index out of range.",
       ShowFirstLast = false
   })
    </div>
    <table class="tableList" cellpadding="0" cellspacing="0" style="font-size: 14px">
        <tr>
            <th>
                单号
            </th>
            <th>
                业主电话
            </th>
            <th>
                状态
            </th>
            <th>
                录入日期
            </th>
            <th>
                操作
            </th>
        </tr>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @item.OddNumber
                </td>
                <td>
                    @item.Phone
                </td>
                <td class="operation">
                    @if (item.EnumExpressStatus == (int)Poco.Enum.EnumExpressStatus.Not)
                    {
                        <label name="labCbFirst" title="点击更改状态">
                            <a onclick="SetStatus(@item.ID,@item.EnumExpressStatus,this)">未领取</a>
                        </label>
                    }
                    else
                    {
                        <label name="labCbFirst" title="点击更改状态">
                            <a  onclick="SetStatus(@item.ID,@item.EnumExpressStatus,this)">已领取</a>
                        </label>
                    }
                </td>
                <td>
                    @item.EntryDate.ToString("yyyy-MM-dd HH:mm")
                </td>
                <td class="operation">
                    @Html.ActionLink("修改", "Edit", "ExpressCollection", new { HostName = ViewBag.HostName, ID = item.ID }, new { style = "padding-right:5px" }, true)
                    @Ajax.ActionLink("删除", "Delete", "ExpressCollection", new { HostName = ViewBag.HostName }, new AjaxOptions() { UpdateTargetId = "alert", OnBegin = "return AppDelete('“你确定删除吗?”','" + Url.Action("Delete", "ExpressCollection", new { HostName = ViewBag.HostName, ID = item.ID, PageID = ViewBag.PageID }) + "',null)" }, true)
                </td>
            </tr>
        }
    </table>
    <div class="pages" style="margin-bottom: 5px; margin-top: 10px; margin-bottom: 10px;">
        @Html.Pager(Model, new PagerOptions
   {
       PageIndexParameterName = "ID",
       CurrentPagerItemWrapperFormatString = "<span class=\"pagenum_selected\"><a>{0}</a></span>",
       NumericPagerItemWrapperFormatString = "<span class=\"pagenum\">{0}</span>",
       NavigationPagerItemWrapperFormatString = "<span class=\"pagenum\">{0}</span>",
       CssClass = "manage_pages pages",
       SeparatorHtml = "&nbsp;",
       AutoHide = false,
       /*LastPageText = "Last",
       FirstPageText = "First",
       PrevPageText = "Back",
       NextPageText = "Next",*/
       PageIndexOutOfRangeErrorMessage = "Page index out of range.",
       ShowFirstLast = false
   })
    </div>
</div>
