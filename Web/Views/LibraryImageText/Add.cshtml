@{
    ViewBag.Title = "Add";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
    ViewBag.Menu = Poco.SystemConst.Menu.LibraryImage;
}
@section head{
    <link href="@Url.Content("~/Scripts/uploadify/uploadify.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/uploadify/jquery.uploadify.js")" type="text/javascript"></script>
    <script src="@Url.Content("/ueditor/ueditor.config.js")" type="text/javascript"></script>
    <script src="@Url.Content("/ueditor/ueditor.all.js")" type="text/javascript"></script>
    <style>
        .divPreview
        {
            width: 320px;
            padding: 10px; /*margin-bottom: 26px;*/
            border: 1px solid #E7E7E7;
            background-color: #fff;
            box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            -webkit-box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            float: left;
        }
        .divEdit
        {
            width: 525px;
            padding: 10px; /*margin-bottom: 26px;*/
            border: 1px solid #E7E7E7;
            background-color: #F4F4F4;
            box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            -webkit-box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 0 2px 2px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            margin-left: 25px;
            float: left;
        }
        
        .item_img_maintext
        {
            position: absolute;
            left: 130px;
            top: 72px;
            z-index: 0;
        }
        .divEdit > form > div > input[type='text'], .divEdit > form > div > textarea
        {
            width: 100%;
        }
        .divEdit > form > div
        {
            margin: 5px 0px 10px 0px;
        }
        .div_title
        {
            margin-bottom: 5px;
        }
        .divPreview div
        {
            height: 20px;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            var addUrl = '@Url.Action("Add", "LibraryImageText", new { HostName = ViewBag.HostName })';
            window.UEDITOR_HOME_URL = "/ueditor/";
            //实例化编辑器
            var options = {
                initialFrameWidth: '100%',
                initialFrameHeight: 300,
                imageUrl: UEDITOR_HOME_URL + "net/imageUp_LibraryImageText.ashx",
                imagePath: "",
                imageManagerUrl: UEDITOR_HOME_URL + "net/imageManager_LibraryImageText.ashx",
                imageManagerPath: "",
                initialContent: ""
            };

            var ue = UE.getEditor('editor', options);

            $("#CoverImagePathFile").change(function () {
                var fileName = $("#CoverImagePathFile").val();
                if (fileName.length == 0) { return false; }
                $("#ImagePath").val(fileName);
                var suffix = fileName.substring(fileName.lastIndexOf('.')).toLowerCase();
                switch (suffix) {
                    case ".jpg":
                    case ".jpeg":
                    case ".png":
                    case ".gif":
                    case ".bmp":
                        break;
                    default:
                        JAlert({
                            Message: "格式限制：jpg, jpge, gif, png, bmp",
                            DialogType: "Ok",
                            BtnOk: "确定"
                        });
                        return false;
                        break;
                }
                var input = this;
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $("#imgCoverPreview").attr('src', e.target.result);
                    };
                    reader.readAsDataURL(input.files[0]);
                }
                return false;
            });

            $("#btnAdd").click(function () {
                if ($("#Title").val().trim().length == 0) {
                    return myAlert("标题不能为空。");
                }
                var imgLength = $("#imgCoverPreview").attr("src");
                if (imgLength == null || imgLength.length == 0) {
                    return myAlert("封面图片不能为空。");
                }
                if ($("#Summary").val().trim().length == 0) {
                    return myAlert("摘要不能为空。");
                }
                if (ue.getContent().length == 0) {
                    return myAlert("正文不能为空。");
                }
                return true;
            });

            $("#Title").focus().keyup(function () {
                var title = $(this).val().trim();
                if (title.length == 0) {
                    $("#itemMain_title").text("标题");
                } else {
                    $("#itemMain_title").text(title);
                }
            });

            $("#Summary").keyup(function () {
                var summary = $(this).val().trim();
                if (summary.length == 0) {
                    $("#itemMain_summary").text("摘要");
                } else {
                    $("#itemMain_summary").text($(this).val());
                }
            });
        });
        function myAlert(msg) {
            JAlert({
                Message: msg,
                DialogType: "Ok",
                BtnOk: "确定"
            });
            return false;
        }
    </script>
}
@model Poco.LibraryImageText
<div class="title">
    单图文消息</div>
<div class="body">
    <div class="divPreview">
        <div id="itemMain_title" style="width: 300px; word-break: break-all; word-wrap: break-word;">
            标题</div>
        <div style="height: 160px; position: relative; border: 1px solid #E7E7E7; margin-top: 10px;">
            <span class="item_img_maintext">封面图片</span>
            <img id="imgCoverPreview" style="width: 298px; max-height: 160px; margin: auto 0px;
                z-index: 1; position: absolute;" />
        </div>
        <div id="itemMain_summary" style="margin-top: 15px; margin-bottom: 10px; width: 300px;
            word-wrap: break-word;">
            摘要
        </div>
    </div>
    <div class="divEdit">
        @using (Html.BeginForm("Add", "LibraryImageText", new { }, FormMethod.Post, new { enctype = "multipart/form-data" }))
        {
            <div>
                <div class="div_title">
                    标题</div>
                @Html.TextBoxFor(a => a.Title)
            </div>
            <div>
                <div class="div_title">
                    封面</div>
                <input type="button" value="选择文件" onclick="$('#CoverImagePathFile').click()" class="button" />
                <input type="file" id="CoverImagePathFile" name="CoverImagePathFile" style="visibility: hidden;
                    float: left; width: 0px;" />
                @Html.TextBoxFor(a => a.ImagePath, new { style = "width:0px;visibility:hidden" })
            </div>
            <div>
                <div class="div_title">
                    摘要</div>
                @Html.TextAreaFor(a => a.Summary)
            </div>
            <div>
                <div class="div_title" id="divContent">
                    正文</div>
                <script type="text/plain" id="editor" height="300px" name="Content"></script>
            </div>
            <div>
                <input type="submit" value="完成" id="btnAdd" class="button" />
            </div>
        }
    </div>
    <div style="clear: both">
    </div>
</div>
